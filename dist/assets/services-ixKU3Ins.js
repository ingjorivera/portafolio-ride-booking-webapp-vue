import{u as S,a0 as n,av as q,n as f,b0 as c}from"./index-DdqqIGr3.js";const L={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_ACCOUNTS_URL:"https://accounts.drivania.com/",VITE_BASE_URL:"https://bag.drivania.com",VITE_COOKIE_NAME:"drivaniaCKSC",VITE_GOOGLE_MAPS_API_KEY:"AIzaSyC3AbAJxQjU8jph9ai6tH5G58moyPHWx_A",VITE_HOMEPAGE:"https://www.drivania.com"},e=S(),i=n(),k=L,u=`${k.VITE_BASE_URL}`,M=q("services",{state:()=>({listClients:f([]),listStaffs:f([]),listLocations:f([]),listFbos:f([]),selectedID:f(""),listClientsPage:f(0),listStaffsPage:f(0),searchKeyword:f(""),currentPage:f(1)}),actions:{async getClients(){const t=n();this.listClientsPage==1&&(this.listClients=[]),e.isLoading=!0;const{error:r,data:a}=await c(u+"/name="+this.searchKeyword,{headers:{Authorization:`Bearer ${t.token}`}}).get().json();if(r.value){e.isError=!0,e.isLoading=!1,e.errorMessage="Error getting clients",e.createNotification(e.errorMessage,"negative","top","drv-alert-triangle");return}else{if(e.isLoading=!1,a.value.length==0&&e.createNotification("No clients found","negative","top","drv-alert-triangle"),this.currentPage==1)return a.value.data.length==0?(this.listClients=[],!0):(this.listClients=a.value.data,!1);if(a.value.data.length==0)return!0;for(let s=0;s<a.value.data.length;s++)this.listClients.push(a.value.data[s]);return!1}},async getClientsByName(t){const r=n(),{error:a,data:s}=await c(u+"/clients?name="+t,{headers:{Authorization:`Bearer ${r.token}`}}).get().json();if(a.value){e.isError=!0,e.isLoading=!1,e.errorMessage="Error getting clients",e.createNotification(e.errorMessage,"negative","top","drv-alert-triangle");return}else{if(e.isLoading=!1,s.value.data.length==0)return this.listClients=[],"No clients found";this.listClients=[];for(let o=0;o<s.value.data.length;o++)this.listClients.push(s.value.data[o])}},async modifyClient(t,r,a,s,o,l,d,g,p,v){const h=n();e.isLoading=!0;const _=parseInt(l.toString()),{error:y,data:E,statusCode:R,onFetchFinally:m}=await c(u+"/clients/"+t,{headers:{Authorization:`Bearer ${h.token}`}}).patch({name:r,taxNumber:a,email:s,phone:o,country_id:_,county:d,city:g,postal_code:p,address:v}).json();if(y.value){e.isError=!0,e.isLoading=!1,e.errorMessage="Error modifying client";return}m(()=>(e.isLoading=!1,e.createNotification("Saved successfully","positive","top","drv-check-square-broken"),!0))},async createClient(t,r,a,s,o,l,d,g,p){const v=n();e.isLoading=!0;const h=parseInt(a.toString()),{error:_,data:y}=await c(u+"/clients",{headers:{Authorization:`Bearer ${v.token}`}}).post({name:t,phone:g,email:p,tax:r,address:d,postcode:l,city:o,country_id:h,county:s}).json();if(_.value){e.isError=!0,e.isLoading=!1,e.errorMessage="Error creating client",e.createNotification(e.errorMessage,"negative","top","drv-alert-triangle");return}else e.isLoading=!1,e.createNotification("Created successfully","positive","top","drv-check-square-broken"),this.getClients()},async deleteClient(t){const r=n();e.isLoading=!0;const{error:a,data:s}=await c(u+"/clients/"+t,{headers:{Authorization:`Bearer ${r.token}`}}).delete().json();if(a.value){e.isError=!0,e.isLoading=!1,e.errorMessage="Error deleting client",e.createNotification(e.errorMessage,"negative","top","drv-alert-triangle");return}else e.isLoading=!1,e.createNotification("Deleted successfully","positive","top","drv-check-square-broken")},async getStaffByID(t){const r=n();e.isLoading=!0;const{error:a,data:s}=await c(u+"/staffs/"+t,{headers:{Authorization:`Bearer ${r.token}`}}).get().json();if(a.value){e.isError=!0,e.isLoading=!1,e.errorMessage="Error getting staff",e.createNotification(e.errorMessage,"negative","top","drv-alert-triangle");return}else{e.isLoading=!1,console.log(s.value),r.currentUserInfo=s.value[0];return}},async getStaffs(){const t=n();this.currentPage==1&&(this.listStaffs=[]),e.isLoading=!0;const{error:r,data:a}=await c(u+"/staffs?page="+this.currentPage+"&name="+this.searchKeyword,{headers:{Authorization:`Bearer ${t.token}`}}).get().json();if(r.value){e.isError=!0,e.isLoading=!1,e.errorMessage="Error getting staffs",e.createNotification(e.errorMessage,"negative","top","drv-alert-triangle");return}else{if(e.isLoading=!1,this.currentPage==1)return a.value.length==0?(this.listStaffs=[],!0):(console.log(a),this.listStaffs=a.value,!1);if(a.value.length==0)return!0;for(let s=0;s<a.value.length;s++)this.listStaffs.push(a.value[s]);return!1}},async modifyStaff(t,r,a,s,o){const l=n();e.isLoading=!0;const{error:d,data:g}=await c(u+"/staffs/"+t,{headers:{Authorization:`Bearer ${l.token}`}}).patch({name:r,email:a,phone:s,mobile:o}).json();return d.value?(e.isError=!0,e.isLoading=!1,e.errorMessage="Error modifying staff",e.createNotification(e.errorMessage,"negative","top","drv-alert-triangle"),!1):(e.isLoading=!1,e.createNotification("Saved successfully","positive","top","drv-check-square-broken"),!0)},async createStaff(t,r,a,s,o){const l=n();e.isLoading=!0;const{error:d,data:g}=await c(u+"/staffs",{headers:{Authorization:`Bearer ${l.token}`}}).post({name:t,email:r,phone:a,mobile:s,username:o}).json();return d.value?(e.isError=!0,e.isLoading=!1,e.errorMessage="Error creating staff",e.createNotification(e.errorMessage,"negative","top","drv-alert-triangle"),!1):(e.isLoading=!1,e.createNotification("Created successfully","positive","top","drv-check-square-broken"),this.getStaffs(),!0)},async deleteStaff(t){const r=n();e.isLoading=!0;const{error:a,data:s}=await c(u+"/staffs/"+t,{headers:{Authorization:`Bearer ${r.token}`}}).delete().json();return a.value?(e.isError=!0,e.isLoading=!1,e.errorMessage="Error deleting staff",e.createNotification(e.errorMessage,"negative","top","drv-alert-triangle"),!1):(e.isLoading=!1,e.createNotification("Deleted successfully","positive","top","drv-check-square-broken"),!0)},async changeStaffPassword(t,r){const a=n();e.isLoading=!0;const{error:s,data:o}=await c(u+"/staffs/"+t+"/change-password",{headers:{Authorization:`Bearer ${a.token}`}}).post({username:r,service:"booking"}).json();return s.value?(e.isError=!0,e.isLoading=!1,e.errorMessage="Error changing password",e.createNotification(e.errorMessage,"negative","top","drv-alert-triangle"),!1):(e.isLoading=!1,e.createNotification("Password changed successfully","positive","top","drv-check-square-broken"),!0)},sortUserFirst(){var r;const t=n();for(let a=0;a<this.listStaffs.length;a++)if(this.listStaffs[a].email.email==((r=t.payload)==null?void 0:r.email)){this.listStaffs.unshift(this.listStaffs.splice(a,1)[0]);break}},async searchLocations(t){e.isLoading=!0;const{error:r,data:a}=await c(u+"/locations?query="+t,{headers:{Authorization:`Bearer ${i.token}`}}).get().json();if(r.value){e.isError=!0,e.isLoading=!1,e.errorMessage="Error getting locations",e.createNotification(e.errorMessage,"negative","top","drv-alert-triangle");return}else e.isLoading=!1,this.listLocations=a.value},async quoteRequest(t,r){const a=n();e.isLoading=!0;const s=[];s[0]={quote_client_id:r||null,service_type:t,segments:this.getSegments(t),passengers:1,lang:"en"};const o=JSON.stringify(s),{error:l,data:d}=await c(u+"/quote-requests",{method:"POST",headers:{Authorization:`Bearer ${a.token}`,"Content-Type":"application/json",Accept:"application/json"},body:o}).json();return l.value?(e.isError=!0,e.isLoading=!1,e.errorMessage="Error getting quote",e.createNotification(e.errorMessage,"negative","top","drv-alert-triangle"),a.quoteRes=[],!1):(e.isLoading=!1,a.quoteRes=d.value.collection,!0)},getSegments(t){const r=[],a=this.convertDate(i.quoteRide.date_1,i.quoteRide.time_1);if(t==1)r.push({name:i.quoteRide.pickup_1.name,type:i.quoteRide.pickup_1.type,lat:i.quoteRide.pickup_1.lat.toString(),lon:i.quoteRide.pickup_1.lon.toString(),date_time:a,airport_code:i.quoteRide.pickup_1.iata?i.quoteRide.pickup_1.iata:i.quoteRide.pickup_1.icao||""}),r.push({name:i.quoteRide.dropoff_1.name,type:i.quoteRide.dropoff_1.type,lat:i.quoteRide.dropoff_1.lat.toString(),lon:i.quoteRide.dropoff_1.lon.toString(),date_time:a,airport_code:i.quoteRide.dropoff_1.iata?i.quoteRide.dropoff_1.iata:i.quoteRide.dropoff_1.icao||""});else if(t==2){const s=this.convertDate(i.quoteRide.date_1,i.quoteRide.time_2||"");r.push({name:i.quoteRide.pickup_1.name,type:i.quoteRide.pickup_1.type,lat:i.quoteRide.pickup_1.lat.toString(),lon:i.quoteRide.pickup_1.lon.toString(),date_time:a,airport_code:i.quoteRide.pickup_1.iata?i.quoteRide.pickup_1.iata:i.quoteRide.pickup_1.icao||""}),r.push({name:i.quoteRide.dropoff_1.name,type:i.quoteRide.dropoff_1.type,lat:i.quoteRide.dropoff_1.lat.toString(),lon:i.quoteRide.dropoff_1.lon.toString(),date_time:s,airport_code:i.quoteRide.dropoff_1.iata?i.quoteRide.dropoff_1.iata:i.quoteRide.dropoff_1.icao||""})}return r},convertDate(t,r){return new Date(t+" "+r).toISOString()},temp(){const t=n(),r=new Headers;r.append("Content-Type","application/json"),r.append("Accept","application/json"),r.append("Authorization",`Bearer ${t.token}`);const a=JSON.stringify([{quote_client_id:null,service_type:1,segments:[{name:"BCN LEBL Barcelona El Prat Airport",type:2,lat:"41.297445",lon:"2.083294",date_time:"2024-11-24T13:00Z",airport_code:"BCN"},{name:"QSA Sabadell Airport",type:2,lat:"41.5214",lon:"2.0998",date_time:"2024-11-24T14:00Z",airport_code:"QSA"}],passengers:3,lang:"en"}]);fetch("https://preaws-bag.drivania.com/quote-requests",{method:"POST",headers:r,body:a,redirect:"follow"}).then(o=>o.text()).then(o=>{const l=JSON.parse(o);l&&l.collection}).catch(o=>console.error(o))},async getFbos(t){const{error:r,data:a}=await c(u+"/fbos?airport_code="+t,{headers:{Authorization:`Bearer ${i.token}`}}).get().json();return r.value?(e.isError=!0,e.isLoading=!1,e.errorMessage="Error getting Fbos",e.createNotification(e.errorMessage,"negative","top","drv-alert-triangle"),i.quoteRes=[],!1):(e.isLoading=!1,this.listFbos=a.value,!0)},async saveQuote(){var o,l,d,g,p;const t={bookingAgentId:0,staffId:"",clientReference:"",confirm:!1,invoice:{invoiceTo:"",agentId:0,clientId:null,payment:{type:0,creditCardId:""}},services:[],ipClient:"",userAgent:"",salesPlatform:0},r=n();t.bookingAgentId=((o=r.payload)==null?void 0:o.cid)||0,t.staffId=((l=r.payload)==null?void 0:l.sid)||"",t.clientReference=((d=r.payload)==null?void 0:d.cna)||"",t.confirm=!1,t.invoice.invoiceTo="",t.invoice.agentId=((g=r.payload)==null?void 0:g.cid)||0,t.invoice.clientId=null,t.invoice.payment.type=0,t.invoice.payment.creditCardId=((p=r.payload)==null?void 0:p.cna)||"",t.services[0].type="",t.services[0].serviceDescription="One way",t.services[0].passenger.name=r.passengerDetails.fullName,t.services[0].passenger.phone=r.passengerDetails.cellphone,t.services[0].passenger.email=r.passengerDetails.email,t.services[0].pax=r.passengerDetails.numTravelers,t.services[0].flights.pickup=null,t.services[0].flights.dropoff=null,t.services[0].fbo=null,t.services[0].comments="",t.services[0].serviceID="",t.services[0].vehicleID="";const{error:a,data:s}=await c(u+"/services",{headers:{Authorization:`Bearer ${r.token}`}}).post(t).json();if(a.value){e.isError=!0,e.isLoading=!1,e.errorMessage="Error saving quote",e.createNotification(e.errorMessage,"negative","top","drv-alert-triangle");return}else return e.isLoading=!1,console.log(s.value),!0}}});export{M as u};
